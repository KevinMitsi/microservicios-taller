# Flujo de Pruebas de Integraciรณn

## ๐ Diagrama de Flujo de Pruebas

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    INICIO DE PRUEBAS                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 1: Verificaciรณn de Prerequisitos                          โ
โ  โข Java 21 instalado                                             โ
โ  โข Maven 3.8+ disponible                                         โ
โ  โข Docker Compose corriendo                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 2: Health Check de Servicios (Smoke Test)                 โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ          โ
โ  โ msvc-securityโ  โ msvc-saludo  โ  โ msvc-consumerโ          โ
โ  โ   :8080      โ  โ    :80       โ  โ   :8081      โ          โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ          โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ                            โ
โ  โmsvc-orch     โ  โ RabbitMQ     โ                            โ
โ  โ  :8083       โ  โ   :5672      โ                            โ
โ  โโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 3: Pruebas de Autenticaciรณn (Test 2)                      โ
โ                                                                  โ
โ  1. Registrar Usuario                                           โ
โ     POST /api/users                                             โ
โ     โโ> msvc-security                                           โ
โ     โโ> MongoDB                                                 โ
โ                                                                  โ
โ  2. Login                                                       โ
โ     POST /api/auth/login                                        โ
โ     โโ> msvc-security                                           โ
โ     โโ> Generar JWT Token                                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 4: Pruebas de Servicios Individuales (Test 3)             โ
โ                                                                  โ
โ  GET /saludo?nombre=Test                                        โ
โ  โโ> msvc-saludo                                                โ
โ  โโ> Respuesta: "Hola Test, bienvenido..."                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 5: Pruebas de Integraciรณn (Test 4)                        โ
โ                                                                  โ
โ  GET /consumeApps/{nombre}                                      โ
โ  โโ> msvc-consumer                                              โ
โ  โ    โโ> Generar credenciales aleatorias                       โ
โ  โ    โโ> POST /api/auth/login โ msvc-security                 โ
โ  โ    โ    โโ> Obtener token JWT                                โ
โ  โ    โโ> GET /saludo?nombre={nombre} โ msvc-saludo            โ
โ  โ         โโ> Con Authorization: Bearer {token}                โ
โ  โโ> Respuesta final con saludo                                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 6: Pruebas de Gestiรณn de Usuarios (Test 5)                โ
โ                                                                  โ
โ  1. Listar Usuarios (GET /api/users)                            โ
โ     โโ> Requiere autenticaciรณn JWT                             โ
โ                                                                  โ
โ  2. Obtener Usuario por ID (GET /api/users/{id})                โ
โ     โโ> Validar datos del usuario                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 7: Pruebas de Orchestrator (Test 6)                       โ
โ                                                                  โ
โ  1. GET /api/notifications/channels                             โ
โ     โโ> Obtener canales disponibles (email, sms, etc.)         โ
โ                                                                  โ
โ  2. GET /api/notifications/templates                            โ
โ     โโ> Obtener templates de notificaciรณn                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 8: Pruebas de Resiliencia (Test 7)                        โ
โ                                                                  โ
โ  1. Credenciales Invรกlidas                                      โ
โ     POST /api/auth/login (usuario/pass incorrectos)             โ
โ     โโ> Esperar cรณdigo 401/400                                 โ
โ                                                                  โ
โ  2. Token Invรกlido                                              โ
โ     GET /api/users con token invรกlido                           โ
โ     โโ> Esperar cรณdigo 401/403                                 โ
โ                                                                  โ
โ  3. Verificar Sistema Sigue Operativo                           โ
โ     โโ> Health checks despuรฉs de errores                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 9: Pruebas de Performance (Test 9)                        โ
โ                                                                  โ
โ  Ejecutar 5 peticiones concurrentes                             โ
โ  โโ> Peticiรณn 1: GET /saludo?nombre=Test1                      โ
โ  โโ> Peticiรณn 2: GET /saludo?nombre=Test2                      โ
โ  โโ> Peticiรณn 3: GET /saludo?nombre=Test3                      โ
โ  โโ> Peticiรณn 4: GET /saludo?nombre=Test4                      โ
โ  โโ> Peticiรณn 5: GET /saludo?nombre=Test5                      โ
โ                                                                  โ
โ  Medir tiempo total y promedio                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  PASO 10: Flujo End-to-End Completo (Test 10)                   โ
โ                                                                  โ
โ  1. Registrar nuevo usuario E2E                                 โ
โ  2. Autenticar usuario E2E                                      โ
โ  3. Obtener saludo con token                                    โ
โ  4. Usar consumer service                                       โ
โ  5. Verificar todos los servicios siguen UP                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  GENERACIรN DE REPORTES                                          โ
โ                                                                  โ
โ  โข Maven Surefire Reports (XML/TXT)                             โ
โ    โโ> target/surefire-reports/                                โ
โ                                                                  โ
โ  โข Cucumber HTML Report                                         โ
โ    โโ> target/cucumber-reports.html                            โ
โ                                                                  โ
โ  โข Logs de ejecuciรณn en consola                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  โ PRUEBAS COMPLETADAS                          โ
โ                                                                  โ
โ  Resultados:                                                     โ
โ  โข Tests ejecutados: 10+                                        โ
โ  โข Escenarios BDD: 7                                            โ
โ  โข Servicios verificados: 6                                     โ
โ  โข Endpoints probados: 20+                                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ Flujo de Datos entre Servicios

```
โโโโโโโโโโโโโโโโ
โ   Cliente    โ
โ  (Pruebas)   โ
โโโโโโโโฌโโโโโโโโ
       โ
       โ 1. GET /consumeApps/{nombre}
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโ
โ   msvc-consumer      โ
โ     (Puerto 8081)    โ
โโโโโโโโฌโโโโโโโโโโโโโโโโ
       โ
       โ 2. POST /api/auth/login (credenciales aleatorias)
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ
โ   msvc-security      โโโโโโโโโโโค   MongoDB    โ
โ     (Puerto 8080)    โ 3. Queryโ   :27017     โ
โโโโโโโโฌโโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ
       โ
       โ 4. JWT Token
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโ
โ   msvc-consumer      โ
โ  (Guarda el token)   โ
โโโโโโโโฌโโโโโโโโโโโโโโโโ
       โ
       โ 5. GET /saludo?nombre={nombre}
       โ    Authorization: Bearer {token}
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโ
โ   msvc-saludo        โ
โ     (Puerto 80)      โ
โโโโโโโโฌโโโโโโโโโโโโโโโโ
       โ
       โ 6. "Hola {nombre}, bienvenido..."
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโ
โ   msvc-consumer      โ
โ  (Retorna respuesta) โ
โโโโโโโโฌโโโโโโโโโโโโโโโโ
       โ
       โ 7. Respuesta final
       โผ
โโโโโโโโโโโโโโโโ
โ   Cliente    โ
โ  (Valida)    โ
โโโโโโโโโโโโโโโโ
```

## ๐ฏ Cobertura de Pruebas por Servicio

```
msvc-security (8080)
โโ โ Health check
โโ โ Registro de usuarios
โโ โ Autenticaciรณn JWT
โโ โ Listar usuarios (paginado)
โโ โ Obtener usuario por ID
โโ โ Manejo de errores (401/400)
โโ โ Validaciรณn de tokens

msvc-saludo (80)
โโ โ Health check
โโ โ Saludo personalizado
โโ โ Autenticaciรณn con Bearer token

msvc-consumer (8081)
โโ โ Health check
โโ โ Flujo completo de integraciรณn
โโ โ Generaciรณn de credenciales
โโ โ Orquestaciรณn de servicios

msvc-orchestrator (8083)
โโ โ Health check
โโ โ Listar canales
โโ โ Listar templates
โโ โ Crear notificaciรณn
โโ โ Buscar notificaciones

msvc-delivery (8082)
โโ โ Consumo de cola RabbitMQ
โโ โ Envรญo de notificaciones

msvc-monitoring (8000)
โโ โ Verificaciรณn opcional
```

## ๐ Checklist de Validaciรณn

Cada ejecuciรณn de pruebas valida:

- [ ] Todos los servicios estรกn UP (health checks)
- [ ] Se puede registrar un nuevo usuario
- [ ] Se puede autenticar y obtener token JWT
- [ ] El token es vรกlido y funcional
- [ ] Se puede listar usuarios con autenticaciรณn
- [ ] Se puede obtener saludo personalizado
- [ ] El consumer integra correctamente los servicios
- [ ] El sistema rechaza credenciales invรกlidas
- [ ] El sistema protege endpoints con autenticaciรณn
- [ ] El sistema maneja peticiones concurrentes
- [ ] Los servicios siguen operativos despuรฉs de errores
- [ ] El flujo end-to-end completo funciona

## ๐ Ejecuciรณn en Pipeline CI/CD

```
โโโโโโโโโโโโโโโโโโ
โ  Git Push      โ
โโโโโโโโโโฌโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโ
โ  Jenkins Trigger   โ
โโโโโโโโโโฌโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโ
โ  Build Stage       โ
โ  (Maven compile)   โ
โโโโโโโโโโฌโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโ
โ  Docker Compose    โ
โ  (Start Services)  โ
โโโโโโโโโโฌโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโ
โ  Smoke Tests       โ
โ  (Quick check)     โ
โโโโโโโโโโฌโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโ
โ  Integration Tests โ
โ  (Full suite)      โ
โโโโโโโโโโฌโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโ
โ  Generate Reports  โ
โ  โข JUnit XML       โ
โ  โข Cucumber HTML   โ
โโโโโโโโโโฌโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโ
โ  Publish Results   โ
โ  (Jenkins/GitHub)  โ
โโโโโโโโโโฌโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโ
โ  Cleanup           โ
โ  (docker-compose   โ
โ   down)            โ
โโโโโโโโโโโโโโโโโโโโโโ
```

---

**รltima actualizaciรณn**: Octubre 2025

